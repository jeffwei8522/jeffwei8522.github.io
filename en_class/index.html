<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>é«˜ä¸‰å­¸æ¸¬è‹±æ–‡ - å­¸ç¿’ç¸½è¦½</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet"/>
  <style>
    body { font-family: 'Noto Sans TC', sans-serif; }
    .today { background-color: #3b82f6; color: white; border-radius: 9999px; }
    .has-material:hover { background-color: #dbeafe; border-radius: 9999px; }
    .dot { height: 6px; width: 6px; background-color: #16a34a; border-radius: 50%;
           position: absolute; bottom: 6px; left: 50%; transform: translateX(-50%); }
  </style>
</head>
<body class="bg-gray-100 p-4 sm:p-8">

  <div class="max-w-4xl mx-auto bg-white rounded-2xl shadow-lg p-6 sm:p-10">
    <header class="text-center mb-12">
      <h1 class="text-3xl sm:text-4xl font-bold text-blue-800 mb-2">é«˜ä¸‰å­¸æ¸¬è‹±æ–‡ - å­¸ç¿’ç¸½è¦½ ğŸ“…</h1>
      <p class="text-lg text-gray-600">æ‰€æœ‰èª²ç¨‹èˆ‡æ•™æä¸€ç›®äº†ç„¶</p>
    </header>

    <main>
      <section id="calendar-widget">
        <h2 class="text-2xl font-bold text-blue-700 border-b-2 border-blue-200 pb-2 mb-6">èª²ç¨‹æ—¥æ›†</h2>
        <div class="bg-gray-50 p-4 sm:p-6 rounded-lg shadow-inner">
          <div class="flex items-center justify-between mb-4">
            <button id="prev-month" class="px-3 py-1 bg-gray-200 hover:bg-gray-300 rounded-lg text-gray-700 transition-colors">â—€</button>
            <h3 id="month-year" class="text-xl font-bold text-gray-800 w-40 text-center"></h3>
            <button id="next-month" class="px-3 py-1 bg-gray-200 hover:bg-gray-300 rounded-lg text-gray-700 transition-colors">â–¶</button>
          </div>

          <div class="grid grid-cols-7 gap-1 text-center text-sm font-medium text-gray-600 mb-2">
            <div>æ—¥</div><div>ä¸€</div><div>äºŒ</div><div>ä¸‰</div><div>å››</div><div>äº”</div><div>å…­</div>
          </div>
          <div id="calendar-grid" class="grid grid-cols-7 gap-1"></div>
        </div>
      </section>
    </main>

    <footer class="text-center mt-16 pt-8 border-t border-gray-200">
      <p class="text-gray-500">æ¸…å¤§æ–‡ç†è£œç¿’ç­ | Jeff</p>
    </footer>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', async function () {
      // ---- è®€å–æ•™ææ¸…å–® ----
      let materialsData = {};
      try {
        const res = await fetch('materials/manifest.json', { cache: 'no-store' });
        if (res.ok) {
          materialsData = await res.json(); // å½¢å¦‚ { "2025-08-10": { "title": "...", "url": "materials/250810.html" }, ... }
        } else {
          console.warn('è®€å– materials/manifest.json å¤±æ•—ï¼š', res.status);
        }
      } catch (err) {
        console.warn('è®€å– materials/manifest.json ç™¼ç”ŸéŒ¯èª¤ï¼š', err);
      }

      const calendarGrid = document.getElementById('calendar-grid');
      const monthYearDisplay = document.getElementById('month-year');
      const prevMonthBtn = document.getElementById('prev-month');
      const nextMonthBtn = document.getElementById('next-month');

      // æ”¯æ´ ?date=YYYY-MM-DD
      const params = new URLSearchParams(location.search);
      const qDate = params.get('date');
      let currentDate = new Date();
      let selectedDate = null;

      if (qDate && !isNaN(Date.parse(qDate))) {
        currentDate = new Date(qDate);
        selectedDate = qDate;
      }

      function renderCalendar() {
        const year = currentDate.getFullYear();
        const month = currentDate.getMonth(); // 0-11
        const today = new Date();

        monthYearDisplay.textContent = `${year}å¹´ ${month + 1}æœˆ`;
        calendarGrid.innerHTML = '';

        const firstDayOfMonth = new Date(year, month, 1).getDay(); // 0=é€±æ—¥
        const lastDateOfMonth = new Date(year, month + 1, 0).getDate();
        const lastDateOfPrevMonth = new Date(year, month, 0).getDate();

        // ä¸Šå€‹æœˆè£œä½
        for (let i = firstDayOfMonth; i > 0; i--) {
          const day = lastDateOfPrevMonth - i + 1;
          calendarGrid.innerHTML += `<div class="p-2 text-gray-300">${day}</div>`;
        }

        // æœ¬æœˆæ—¥æœŸ
        for (let i = 1; i <= lastDateOfMonth; i++) {
          const dayCell = document.createElement('div');
          dayCell.className = 'p-2 relative flex justify-center items-center cursor-pointer';

          const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(i).padStart(2, '0')}`;

          let content;
          if (materialsData[dateStr]) {
            const material = materialsData[dateStr];
            dayCell.classList.add('has-material');
            content = document.createElement('a');
            content.href = material.url;
            content.title = material.title;
            content.innerHTML = `${i}<span class="dot"></span>`;
            content.className = 'w-full h-full flex justify-center items-center';
          } else {
            content = document.createElement('span');
            content.textContent = i;
          }

          // æ¨™ç¤ºä»Šå¤©
          if (year === today.getFullYear() && month === today.getMonth() && i === today.getDate()) {
            (content.tagName === 'A' ? content : dayCell).classList.add('today');
          }

          // æ¨™ç¤ºå¾ ?date= å¸¶å›ä¾†çš„é‚£ä¸€å¤©
          if (selectedDate && dateStr === selectedDate) {
            dayCell.classList.add('ring-2', 'ring-blue-500', 'rounded-full');
          }

          dayCell.appendChild(content);
          calendarGrid.appendChild(dayCell);
        }
      }

      prevMonthBtn.addEventListener('click', () => {
        currentDate.setMonth(currentDate.getMonth() - 1);
        renderCalendar();
      });

      nextMonthBtn.addEventListener('click', () => {
        currentDate.setMonth(currentDate.getMonth() + 1);
        renderCalendar();
      });

      renderCalendar();
    });
  </script>
</body>
</html>
